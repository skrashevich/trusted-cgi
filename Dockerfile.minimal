FROM golang:1.16 AS builder
ADD . /app
WORKDIR /app
RUN go mod download
RUN make clean
RUN make ui/dist
RUN make bindata
RUN go install ./cmd/...

FROM alpine:latest
RUN apk add --no-cache make
EXPOSE 3434
VOLUME /data
WORKDIR /data
ENV INITIAL_ADMIN_PASSWORD admin
ENV BIND 0.0.0.0:3434
COPY --from=builder /go/bin/* /usr/bin/
ENTRYPOINT ["/usr/bin/trusted-cgi", "--disable-chroot"]